# AppVeyor CI for Windows

version: 3.9.0-{build}

pull_requests:
  do_not_increment_build_number: true

environment:
  matrix:
  - TARGET: vs2015
    APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
    VisualStudioVersion: 14.0
    platform: x86
    configuration: Release
    name: yara-win32
  - TARGET: vs2015
    APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
    VisualStudioVersion: 14.0
    platform: x86
    configuration: Debug
  - TARGET: vs2015
    APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
    VisualStudioVersion: 14.0
    platform: x64
    configuration: Release
    name: yara-win64
  - TARGET: vs2015
    APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
    VisualStudioVersion: 14.0
    platform: x64
    configuration: Debug
  - TARGET: cygwin

for:
-
  matrix:
    only:
    - TARGET: cygwin

  build_script:
  - cmd: C:\cygwin64\bin\bash -e -l -c "cd c:/projects/yara && ./build.sh"

  test_script:
  - cmd: C:\cygwin64\bin\bash -e -l -c "cd c:/projects/yara && make check"

-
  matrix:
    only:
      - TARGET: vs2015
      - configuration: Release

  before_build:
  - ps: nuget restore windows/vs2015/yara.sln

  build:
    project: windows/vs2015/yara.sln
    verbosity: minimal

  after_build:
  - cmd: 7z a %NAME%.zip %APPVEYOR_BUILD_FOLDER%\windows\%TARGET%\%CONFIGURATION%\*.exe

  artifacts:
  - path: $(name).zip
    name: $(name)
    type: zip

  test: off

-
  matrix:
    only:
      - TARGET: vs2015
      - configuration: Debug

  before_build:
  - ps: nuget restore windows/vs2015/yara.sln

  build:
    project: windows/vs2015/yara.sln
    verbosity: minimal

  test: off

# Uncomment the lines below for enabling Remote Desktop in the Appveyor. This
# allows connecting to the remote machine and debug issues.
# on_finish:
# - ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
